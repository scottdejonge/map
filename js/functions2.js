var typeArray = { 'types': [
	{ 'type': 'accounting', 'color': '#FF0000' },
	{ 'type': 'airport', 'color': '#FF0000' },
	{ 'type': 'amusement_park', 'color': '#FF0000' },
	{ 'type': 'aquarium', 'color': '#FF0000' },
	{ 'type': 'art_gallery', 'color': '#FF0000' },
	{ 'type': 'atm', 'color': '#FF0000' },
	{ 'type': 'bakery', 'color': '#FF0000' },
	{ 'type': 'bank', 'color': '#FF0000' },
	{ 'type': 'bar', 'color': '#FF0000' },
	{ 'type': 'beauty_salon', 'color': '#FF0000' },
	{ 'type': 'bicycle_store', 'color': '#FF0000' },
	{ 'type': 'book_store', 'color': '#FF0000' },
	{ 'type': 'bowling_alley', 'color': '#FF0000' },
	{ 'type': 'bus_station', 'color': '#FF0000' },
	{ 'type': 'cafe', 'color': '#FF0000' },
	{ 'type': 'campground', 'color': '#FF0000' },
	{ 'type': 'car_dealer', 'color': '#FF0000' },
	{ 'type': 'car_rental', 'color': '#FF0000' },
	{ 'type': 'car_repair', 'color': '#FF0000' },
	{ 'type': 'car_wash', 'color': '#FF0000' },
	{ 'type': 'casino', 'color': '#FF0000' },
	{ 'type': 'cemetery', 'color': '#FF0000' },
	{ 'type': 'church', 'color': '#FF0000' },
	{ 'type': 'city_hall', 'color': '#FF0000' },
	{ 'type': 'clothing_store', 'color': '#FF0000' },
	{ 'type': 'convenience_store', 'color': '#FF0000' },
	{ 'type': 'courthouse', 'color': '#FF0000' },
	{ 'type': 'dentist', 'color': '#FF0000' },
	{ 'type': 'department_store', 'color': '#FF0000' },
	{ 'type': 'doctor', 'color': '#FF0000' },
	{ 'type': 'electrician', 'color': '#FF0000' },
	{ 'type': 'electronics_store	  ', 'color': '#FF0000' },
	{ 'type': 'embassy', 'color': '#FF0000' },
	{ 'type': 'establishment', 'color': '#FF0000' },
	{ 'type': 'finance', 'color': '#FF0000' },
	{ 'type': 'fire_station', 'color': '#FF0000' },
	{ 'type': 'florist', 'color': '#FF0000' },
	{ 'type': 'food', 'color': '#FF0000' },
	{ 'type': 'funeral_home', 'color': '#FF0000' },
	{ 'type': 'furniture_store', 'color': '#FF0000' },
	{ 'type': 'gas_station', 'color': '#FF0000' },
	{ 'type': 'general_contractor', 'color': '#FF0000' },
	{ 'type': 'grocery_or_supermarket', 'color': '#FF0000' },
	{ 'type': 'gym', 'color': '#FF0000' },
	{ 'type': 'hair_care', 'color': '#FF0000' },
	{ 'type': 'hardware_store', 'color': '#FF0000' },
	{ 'type': 'health', 'color': '#FF0000' },
	{ 'type': 'hindu_temple', 'color': '#FF0000' },
	{ 'type': 'home_goods_store', 'color': '#FF0000' },
	{ 'type': 'hospital', 'color': '#FF0000' },
	{ 'type': 'insurance_agency', 'color': '#FF0000' },
	{ 'type': 'jewelry_store', 'color': '#FF0000' },
	{ 'type': 'laundry', 'color': '#FF0000' },
	{ 'type': 'lawyer', 'color': '#FF0000' },
	{ 'type': 'library', 'color': '#FF0000' },
	{ 'type': 'liquor_store', 'color': '#FF0000' },
	{ 'type': 'local_government_office', 'color': '#FF0000' },
	{ 'type': 'locksmith', 'color': '#FF0000' },
	{ 'type': 'lodging', 'color': '#FF0000' },
	{ 'type': 'meal_delivery', 'color': '#FF0000' },
	{ 'type': 'meal_takeaway', 'color': '#FF0000' },
	{ 'type': 'mosque', 'color': '#FF0000' },
	{ 'type': 'movie_rental', 'color': '#FF0000' },
	{ 'type': 'movie_theater', 'color': '#FF0000' },
	{ 'type': 'moving_company', 'color': '#FF0000' },
	{ 'type': 'museum', 'color': '#FF0000' },
	{ 'type': 'night_club', 'color': '#FF0000' },
	{ 'type': 'painter', 'color': '#FF0000' },
	{ 'type': 'park', 'color': '#FF0000' },
	{ 'type': 'parking', 'color': '#FF0000' },
	{ 'type': 'pet_store', 'color': '#FF0000' },
	{ 'type': 'pharmacy', 'color': '#FF0000' },
	{ 'type': 'physiotherapist', 'color': '#FF0000' },
	{ 'type': 'place_of_worship', 'color': '#FF0000' },
	{ 'type': 'plumber', 'color': '#FF0000' },
	{ 'type': 'police', 'color': '#FF0000' },
	{ 'type': 'post_office', 'color': '#FF0000' },
	{ 'type': 'real_estate_agency', 'color': '#FF0000' },
	{ 'type': 'restaurant', 'color': '#FF0000' },
	{ 'type': 'roofing_contractor', 'color': '#FF0000' },
	{ 'type': 'rv_park', 'color': '#FF0000' },
	{ 'type': 'school', 'color': '#FF0000' },
	{ 'type': 'shoe_store', 'color': '#FF0000' },
	{ 'type': 'shopping_mall', 'color': '#FF0000' },
	{ 'type': 'spa', 'color': '#FF0000' },
	{ 'type': 'stadium', 'color': '#FF0000' },
	{ 'type': 'storage', 'color': '#FF0000' },
	{ 'type': 'store', 'color': '#FF0000' },
	{ 'type': 'subway_station', 'color': '#FF0000' },
	{ 'type': 'synagogue', 'color': '#FF0000' },
	{ 'type': 'taxi_stand', 'color': '#FF0000' },
	{ 'type': 'train_station', 'color': '#FF0000' },
	{ 'type': 'travel_agency', 'color': '#FF0000' },
	{ 'type': 'university', 'color': '#FF0000' },
	{ 'type': 'veterinary_care', 'color': '#FF0000' },
	{ 'type': 'zoo', 'color': '#FF0000' }
]};

var markers = [];

function initialize() {
	
	// Get User Location
	if(navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(createMap, function() {
			handleNoGeolocation(true);
		});
	} else {
		browserSupportFlag = false;
		handleNoGeolocation(browserSupportFlag);
	}
	
	// Create Map at User Position
	function createMap(position) {	
		userLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
		
		// Google Map Options		
		var mapOptions = {
			zoom: 16,
			scrollWheel: false,
			center: userLocation,
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			mapTypeControl: false,
			panControl: false,
			zoomControl: false,
			scaleControl: false,
			streetViewControl: false,
			styles: [
				{stylers: [{ visibility: 'simplified' }]},
				{elementType: 'labels', stylers: [{ visibility: 'off' }]}
			]
		}
		
		// Create the Map
		map = new google.maps.Map(document.getElementById('map'), mapOptions);
		
		// Create InfoWindow
		var infowindow = new google.maps.InfoWindow();
		
		// Define Map Bounds
		var viewportBox;
		google.maps.event.addListener(map, 'idle', function(event) {
			var bounds = map.getBounds();
			
			var ne = bounds.getNorthEast();
			var sw = bounds.getSouthWest();
			
			var viewportPoints = [
				ne, new google.maps.LatLng(ne.lat(), sw.lng()),
				sw, new google.maps.LatLng(sw.lat(), ne.lng()), ne
			];
			
			if (viewportBox) {
				viewportBox.setPath(viewportPoints);
			} else {
				viewportBox = new google.maps.Polyline({
					path: viewportPoints,
					strokeColor: '#FF0000',
					strokeOpacity: 1.0,
					strokeWeight: 4 
				});
				viewportBox.setMap(map);
			};
			
			var info = document.getElementById('info');
			//console.log('NorthEast: ' + ne.lat() + '   ' + ne.lng() + 'SouthWest: ' + sw.lat() + '   ' + sw.lng());
		});
	
		// Search Places
		var searchInput = (document.getElementById('search-input'));
		var searchBox = new google.maps.places.SearchBox(searchInput);
		
		google.maps.event.addListener(searchBox, 'places_changed', function() {
			var places = searchBox.getPlaces();
			for (var i = 0, marker; marker = markers[i]; i++) {
				marker.setMap(null);
			}
			markers = [];
			var bounds = new google.maps.LatLngBounds();
			createMarkers(places);
		});
		
		// Bounds Change Event
		google.maps.event.addListener(map, 'bounds_changed', function() {
			var bounds = map.getBounds();
			//console.log('Getting Map Bounds' + bounds);
			searchBox.setBounds(bounds);
		});
	}
}

// Create Markers
function createMarkers(places) {
	var bounds = new google.maps.LatLngBounds();
	
	for (var i = 0, place; place = places[i]; i++) {
		var marker = new google.maps.Marker({
			map: map,
			title: place.name,
			position: place.geometry.location,
			animation: google.maps.Animation.DROP,
			icon: {
				path: 'M 100 0 L 0 0 L 0 100 L 35 100 L 50 120 L 65 100 L 100 100 Z',
				fillColor: '#FF0000',
				fillOpacity: 1,
				strokeColor: '',
				strokeWeight: 0,
				scale: 1/2
			}
		});
		
		// Push Marker to Markers Array
		markers.push(marker);
		bounds.extend(place.geometry.location);
	}
	console.log(markers);
	map.fitBounds(bounds);
}


function loadScript() {
	var script = document.createElement('script');
	script.type = 'text/javascript';
	script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&sensor=true&' + 'callback=initialize';
	document.body.appendChild(script);
}

window.onload = loadScript;